# 层叠顺序

## 层叠上下文

html中一个三维概念，如果一个元素含有层叠上下文，这个元素在z轴就高人一等。

## 层叠水平

决定同一个层叠上下文中元素在z轴上的显示顺序。

所有的元素都有层叠水平，包括层叠上下问，也包括普通元素。

*对于普通元素的层叠水平探讨只局限在当前层叠上下文元素中*

需要注意的是：zindex和层叠水平不一样。某些情况下，zindex确实可以影响层叠水平，但只局限于定位元素和flex的孩子元素。而层叠水平所有的元素都存在。

## css2.1层叠顺序

1. 当前层叠上下文的 background/border 【装饰】
2. 负zindex
3. block块状水平盒子 【布局】
4. float浮动盒子 
5. inline水平盒子 【内容】
6. zindex auto或0
7. zindex>0



## 层叠规则

1. 谁大谁上：具有明显的层叠水平标识时，如zindex大的覆盖小的
2. 后来居上：元素的层叠水平一致，层叠顺序一致时，dom流后面的元素覆盖前面的元素



# 关于层叠上下文

## 特性

1. 层叠上下文的层叠水平比普通元素高
2. 层叠上下文可以阻断元素的混合模式
3. 层叠上下文可以嵌套，内部层叠上下文及所有子元素均受制于外部的层叠上下文
4. 每个层叠上下文和兄弟元素独立，当进行层叠变化或渲染的时候，只需要考虑后代元素
5. 每个层叠上下文自成体系，当元素发生层叠的时候，整个元素被认为实在父级层叠上下问的层叠顺序中。

## 创建层叠上下文

和块级格式化上下文一样，层叠上下文也是由一些特定的css属性在创建

1. 天生：页面根元素天生具有层叠上下文，为根层叠上下文
2. 正统：zindex值为*数值*的定位元素，创建的层叠上下文
3. 扩招：其他css3属性

**根层叠上下文**

页面根元素，可以看作html

**定位元素和传统层叠上下文**

对于position为relative/absolute，以及ff/ie浏览器（不包含chrome）下含有fixed声明的定位元素，如果其zindex不是auto，就会创建层叠上下文。

目前chrome等webkit内核浏览器下fixed元素天然层叠上下文

非层叠上下文，则视为普通元素即可。

# css3

新属性对于层叠上下文的影响。

1. flex布局元素（父元素是flex/inline-flex），同时z-index不是auto
2. 元素opacity不是1
3. transform不是none
4. mix-blend-mode不是isolate
5. filter不是none
6. isolation的值为isolate
7. will-change的属性值是2-6中任意一个
8. -webkit-overflow-scrolling设为touch

# 层叠上下文和层叠顺序

一个普通元素具有了层叠上下文，其层叠顺序就会变高。

1. 层叠上下文元素不依赖z-index数值，则其层叠顺序是z-index：auto可看作z-index0级别
2. 如果层叠上下问元素依赖zindex数值，则其层叠顺序由zindex值决定。

